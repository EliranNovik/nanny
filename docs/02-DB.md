# Database (Supabase Postgres) for Nanny MVP

You will create SQL files and upload them to Supabase SQL editor.

Run order:
1) 001_init.sql
2) 002_rls.sql
3) 003_policies.sql

## Tables overview

Auth:
- Supabase auth.users is the source of truth for identity.

App tables:
1) profiles
2) freelancer_profiles
3) job_requests
4) job_candidate_notifications
5) job_confirmations
6) conversations
7) messages

### Key concepts
- "Client" creates job_requests
- Backend generates candidate notifications into job_candidate_notifications
- Freelancer confirms availability => job_confirmations
- Client selects one freelancer => job_requests.status becomes "locked"
- conversation created for the job, messages are realtime

## Status enums

### job_requests.status
- draft
- ready
- notifying
- confirmations_closed
- locked
- active
- completed
- cancelled

### job_candidate_notifications.status
- pending
- opened
- expired
- withdrawn
- selected
- closed

### job_confirmations.status
- available
- declined
- expired

## Table Schemas

### profiles
| Column | Type | Notes |
|--------|------|-------|
| id | uuid | PK, references auth.users |
| role | user_role | 'client' or 'freelancer' |
| full_name | text | |
| phone | text | |
| photo_url | text | |
| city | text | For matching |
| created_at | timestamptz | |
| updated_at | timestamptz | |

### freelancer_profiles
| Column | Type | Notes |
|--------|------|-------|
| user_id | uuid | PK, references profiles |
| bio | text | |
| languages | text[] | |
| has_first_aid | boolean | |
| newborn_experience | boolean | |
| special_needs_experience | boolean | |
| max_children | int | |
| hourly_rate_min | int | |
| hourly_rate_max | int | |
| available_now | boolean | Required for matching |
| availability_note | text | |
| rating_avg | numeric | |
| rating_count | int | |

### job_requests
| Column | Type | Notes |
|--------|------|-------|
| id | uuid | PK |
| client_id | uuid | FK to profiles |
| status | job_status | |
| care_type | text | 'occasional', 'part_time', 'full_time' |
| children_count | int | |
| children_age_group | text | 'newborn', 'infant', 'toddler', etc. |
| location_city | text | |
| start_at | timestamptz | |
| shift_hours | text | |
| languages_pref | text[] | |
| requirements | text[] | |
| budget_min | int | |
| budget_max | int | |
| confirm_window_seconds | int | Default 90 |
| confirm_starts_at | timestamptz | |
| confirm_ends_at | timestamptz | |
| selected_freelancer_id | uuid | |
| locked_at | timestamptz | |

### job_candidate_notifications
| Column | Type | Notes |
|--------|------|-------|
| id | uuid | PK |
| job_id | uuid | FK |
| freelancer_id | uuid | FK |
| status | notification_status | |
| created_at | timestamptz | |
| opened_at | timestamptz | |
| closed_at | timestamptz | |

### job_confirmations
| Column | Type | Notes |
|--------|------|-------|
| id | uuid | PK |
| job_id | uuid | FK |
| freelancer_id | uuid | FK |
| status | confirmation_status | |
| created_at | timestamptz | |

### conversations
| Column | Type | Notes |
|--------|------|-------|
| id | uuid | PK |
| job_id | uuid | FK, unique |
| client_id | uuid | FK |
| freelancer_id | uuid | FK |
| created_at | timestamptz | |

### messages
| Column | Type | Notes |
|--------|------|-------|
| id | uuid | PK |
| conversation_id | uuid | FK |
| sender_id | uuid | FK |
| body | text | |
| created_at | timestamptz | |

## Enable Realtime

After running SQL files, enable Realtime on the following tables in Supabase Dashboard:
- messages (for chat)
- job_candidate_notifications (for freelancer notifications)

